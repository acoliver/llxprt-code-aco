# Phase 11: Legacy Completion Removal

## Phase ID
`PLAN-20251013-AUTOCOMPLETE.P11`

## Completion Date
2025-10-16

## Summary of Work

| Area | File(s) | Notes |
| --- | --- | --- |
| Schema migrations | `packages/cli/src/ui/commands/chatCommand.ts`, `profileCommand.ts`, `toolsCommand.tsx`, `restoreCommand.ts`, `mcpCommand.ts` | Replaced legacy `completion` callbacks with schema definitions and async completers that mirror prior behaviour.
| Slash completion | `packages/cli/src/ui/hooks/useSlashCompletion.tsx`, `slashCommandProcessor.ts` | Removed manual-completion fallback path; UI now relies solely on schema resolver outputs.
| MCP prompt loader | `packages/cli/src/services/McpPromptLoader.ts` | Converted dynamic prompt commands to schema-driven completion with argument de-duplication.
| Type & utility updates | `packages/cli/src/ui/commands/types.ts`, `schema/index.ts` | Dropped `SlashCommand#completion` from the contract and hardened completer handling for non-array returns.
| Tests | `packages/cli/src/ui/commands/*.{test.ts, test.tsx}`, `packages/cli/src/ui/hooks/slashCommandProcessor.test.ts`, `useSlashCompletion.test.ts` | Updated expectations to consume schema results; added coverage for new completer flows.

## Verification Commands

```bash
# Legacy keyword audit
rg "legacyCompletion\|manualCompletion\|OLD_COMPLETION" packages/cli/src/ui | grep -v "schema"

# Type safety
npm run typecheck

# Focused Vitest suites (schema-migrated commands)
npx vitest run src/ui/commands/toolsCommand.test.ts
npx vitest run src/ui/commands/restoreCommand.test.ts
npx vitest run src/ui/commands/chatCommand.test.ts
npx vitest run src/ui/commands/profileCommand.test.ts
npx vitest run src/ui/commands/mcpCommand.test.ts
```

> Note: `npm test -- --filter "@plan:PLAN-20250214-AUTOCOMPLETE"` is no longer accepted by the current Vitest CLI; focused suites above were executed instead.

## Checklist
- [x] Legacy completion code removed
- [x] Tests updated for schema-only flow
- [x] Execution tracker updated
