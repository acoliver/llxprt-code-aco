<!-- @plan:PLAN-20251023-STATELESS-HARDENING.P09 @requirement:REQ-SP4-002 @requirement:REQ-SP4-004 @requirement:REQ-SP4-005 -->
# PLAN-20251023-STATELESS-HARDENING Â· Phase P09 Completion

- Started: 2025-10-25T19:05:00Z
- Finished: 2025-10-25T19:48:31Z

## Verification Output
```
rg "getSettingsService" packages/core/src/providers
packages/core/src/providers/openai-responses/OpenAIResponsesProvider.headers.test.ts:  getSettingsService: () => mockSettingsService,
packages/core/src/providers/openai/OpenAIProvider.modelParamsAndHeaders.test.ts:  getSettingsService: () => mockSettingsService,
packages/core/src/providers/openai/openai-oauth.spec.ts:    const { getSettingsService } = await import(
packages/core/src/providers/openai/openai-oauth.spec.ts:    const globalSettingsService = getSettingsService();
packages/core/src/providers/openai/ResponsesContextTrim.integration.test.ts:  getSettingsService,
packages/core/src/providers/openai/ResponsesContextTrim.integration.test.ts:    const settingsService = getSettingsService();
packages/core/src/providers/BaseProvider.test.ts:  getSettingsService,
packages/core/src/providers/BaseProvider.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/BaseProvider.test.ts:      const defaultSettings = getSettingsService();
packages/core/src/providers/BaseProvider.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/BaseProvider.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/BaseProvider.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/BaseProvider.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/BaseProvider.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/openai/OpenAIProvider.responsesIntegration.test.ts:  getSettingsService,
packages/core/src/providers/openai/OpenAIProvider.responsesIntegration.test.ts:    const settingsService = getSettingsService();
packages/core/src/providers/openai/OpenAIProvider.integration.test.ts:import { getSettingsService } from '../../settings/settingsServiceInstance.js';
packages/core/src/providers/openai/OpenAIProvider.integration.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/openai/OpenAIProvider.callResponses.stateless.test.ts:  getSettingsService,
packages/core/src/providers/openai/OpenAIProvider.callResponses.stateless.test.ts:    const settingsService = getSettingsService();
packages/core/src/providers/gemini/GeminiProvider.test.ts:  getSettingsService: vi.fn(() => mockSettingsService),
packages/core/src/providers/integration/multi-provider.integration.test.ts:  getSettingsService,
packages/core/src/providers/integration/multi-provider.integration.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/integration/multi-provider.integration.test.ts:        const settingsService = getSettingsService();
packages/core/src/providers/integration/multi-provider.integration.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/integration/multi-provider.integration.test.ts:      const settingsService = getSettingsService();
packages/core/src/providers/anthropic/AnthropicProvider.oauth.test.ts:    const { getSettingsService } = await import(
packages/core/src/providers/anthropic/AnthropicProvider.oauth.test.ts:    settingsService = getSettingsService();

rg "runtimeClientCache" packages/core/src/providers
(no matches; exit code 1)

pnpm lint
WARN  Issue while reading ".npmrc". Failed to replace env in config: ${NODE_AUTH_TOKEN}
WARN  The "workspaces" field in package.json is not supported by pnpm. Create a "pnpm-workspace.yaml" file instead.

> @vybestack/llxprt-code@0.5.0 lint /Users/acoliver/projects/llxprt-code
> node ./scripts/run-lint.mjs
```

## Notes
- Removed `runtimeClientCache`/`runtimeClientKeyIndex` from `OpenAIProvider.ts`, simplified `getClient()` to instantiate SDK clients per call, and retained `clearClientCache()` as a compatibility no-op to close out lingering stateful hooks (REQ-SP4-002).
- Updated `openai.stateless.test.ts` expectations so repeated calls inside the same runtime require fresh clients, giving us regression coverage for the P09 stateless contract.
- Added a "Stateless guard behaviour" section to `docs/cli/runtime-helpers.md` and new guidance in `docs/core/provider-interface.md` so downstream teams understand the runtime guard workflow and the prohibition on `getSettingsService()` singletons (REQ-SP4-004 / REQ-SP4-005).
- Captured the changes in `CHANGELOG.md` (0.5.2 entry) and documented the worker evidence in `project-plans/20251023stateless4/reports/P09-worker.md`.
