
 RUN  v3.2.4 /Users/acoliver/projects/llxprt-code

 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts (11 tests | 11 failed) 6ms
   × SubAgentScope - Stateless Behavior (P07 TDD) > Config Mutation Prevention > should NOT call config.setModel() when creating subagent 4ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Config Mutation Prevention > should NOT call config.setProvider() when creating subagent 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Config Mutation Prevention > should NOT call any Config mutator methods 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Runtime View Immutability > should receive frozen AgentRuntimeContext 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Runtime View Immutability > should have frozen runtime state within context 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > History Service Isolation > should allocate isolated history services for each subagent 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > History Service Isolation > should maintain isolated history between subagents 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Runtime State Construction > should construct isolated runtime context with subagent model 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Runtime State Construction > should build runtime context directly without mutating foreground config 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Regression Guards > should throw if legacy setModel is invoked (regression guard) 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
   × SubAgentScope - Stateless Behavior (P07 TDD) > Config Independence > should not read from foreground Config during runtime context construction 0ms
     → MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).

⎯⎯⎯⎯⎯⎯ Failed Tests 11 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Config Mutation Prevention > should NOT call config.setModel() when creating subagent
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:107:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Config Mutation Prevention > should NOT call config.setProvider() when creating subagent
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:141:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Config Mutation Prevention > should NOT call any Config mutator methods
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:176:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Runtime View Immutability > should receive frozen AgentRuntimeContext
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:215:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Runtime View Immutability > should have frozen runtime state within context
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:246:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > History Service Isolation > should allocate isolated history services for each subagent
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:285:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > History Service Isolation > should maintain isolated history between subagents
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:329:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Runtime State Construction > should construct isolated runtime context with subagent model
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:382:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[8/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Runtime State Construction > should build runtime context directly without mutating foreground config
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:414:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[9/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Regression Guards > should throw if legacy setModel is invoked (regression guard)
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:458:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[10/11]⎯

 FAIL  packages/core/src/core/__tests__/subagent.stateless.test.ts > SubAgentScope - Stateless Behavior (P07 TDD) > Config Independence > should not read from foreground Config during runtime context construction
MissingProviderRuntimeError: MissingProviderRuntimeError(provider-runtime): runtime registration missing. Run activateIsolatedRuntimeContext() before invoking providers (REQ-SP4-004).
 ❯ getActiveProviderRuntimeContext packages/core/src/runtime/providerRuntimeContext.ts:83:9
     81|   }
     82| 
     83|   throw new MissingProviderRuntimeError({
       |         ^
     84|     providerKey: 'provider-runtime',
     85|     missingFields: ['runtime registration'],
 ❯ new Config packages/core/src/config/config.ts:396:30
 ❯ createTestConfig packages/core/src/core/__tests__/subagent.stateless.test.ts:37:18
 ❯ packages/core/src/core/__tests__/subagent.stateless.test.ts:492:26

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[11/11]⎯


 Test Files  1 failed (1)
      Tests  11 failed (11)
   Start at  11:50:13
   Duration  1.90s (transform 756ms, setup 0ms, collect 1.55s, tests 6ms, environment 0ms, prepare 40ms)

